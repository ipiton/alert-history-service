openapi: 3.0.3
info:
  title: Alertmanager++ API
  description: |
    **Alertmanager++ OSS Edition** - Enterprise-grade alert management system with intelligent classification, routing, and publishing capabilities.

    ## Features
    - üîç Intelligent alert classification (LLM-powered)
    - üéØ Advanced routing engine (label-based, regex support)
    - üì® Multi-target publishing (Slack, PagerDuty, Rootly, Webhooks)
    - üìä Historical analytics & trend detection
    - ‚öôÔ∏è  Configuration management with hot reload
    - üîê Enterprise-grade security & observability

    ## API Versioning
    - **Current Version**: v2.0.0
    - **Base Path**: `/api/v2`
    - **Header**: `X-API-Version: 2.0.0`

    ## Authentication
    Currently no authentication required (add API key support in future versions).

    ## Rate Limiting
    - Default: 1000 requests/minute per IP
    - Header: `X-RateLimit-Remaining`

    ## Error Handling
    All errors follow standardized format with request ID tracing.

  version: 2.0.0
  contact:
    name: Alertmanager++ Support
    url: https://github.com/ipiton/alert-history-service
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://localhost:8080/api/v2
    description: Local development server
  - url: https://api.alertmanager-plus.example.com/api/v2
    description: Production server

tags:
  - name: System
    description: System health and status endpoints
  - name: Publishing
    description: Alert publishing and target management
  - name: Classification
    description: LLM-powered alert classification
  - name: Enrichment
    description: Alert enrichment mode management
  - name: History
    description: Alert history and analytics
  - name: Configuration
    description: Configuration management and hot reload

components:
  schemas:
    # ============================================================================
    # Error Responses
    # ============================================================================
    Error:
      type: object
      required:
        - status_code
        - code
        - message
      properties:
        status_code:
          type: integer
          description: HTTP status code
          example: 400
        code:
          type: string
          description: Machine-readable error code
          example: "VALIDATION_ERROR"
          enum:
            - VALIDATION_ERROR
            - NOT_FOUND
            - INTERNAL_ERROR
            - BAD_REQUEST
            - UNAUTHORIZED
            - FORBIDDEN
            - CONFLICT
        message:
          type: string
          description: Human-readable error message
          example: "Invalid request body: missing required field 'query'"
        details:
          type: string
          description: Additional error details
          example: "Field 'pagination.page' must be positive integer"
        request_id:
          type: string
          format: uuid
          description: Unique request identifier for debugging
          example: "550e8400-e29b-41d4-a716-446655440000"

    # ============================================================================
    # System Health
    # ============================================================================
    HealthResponse:
      type: object
      required:
        - status
        - version
        - uptime_seconds
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
          description: Overall system health status
          example: "healthy"
        version:
          type: string
          description: Application version
          example: "2.0.0"
        uptime_seconds:
          type: integer
          description: Server uptime in seconds
          example: 86400
        checks:
          type: object
          description: Individual health checks
          properties:
            database:
              type: string
              enum: [pass, fail]
              example: "pass"
            redis:
              type: string
              enum: [pass, fail]
              example: "pass"
            llm:
              type: string
              enum: [pass, fail]
              example: "pass"

    # ============================================================================
    # Publishing
    # ============================================================================
    PublishingTarget:
      type: object
      required:
        - name
        - type
        - endpoint
        - health_status
      properties:
        name:
          type: string
          description: Target name (from K8s Secret label)
          example: "slack-engineering"
        type:
          type: string
          enum: [slack, pagerduty, rootly, webhook]
          description: Target type
          example: "slack"
        endpoint:
          type: string
          format: uri
          description: Target endpoint URL
          example: "https://hooks.slack.com/services/..."
        health_status:
          type: string
          enum: [healthy, degraded, unhealthy]
          description: Target health status
          example: "healthy"
        last_check:
          type: string
          format: date-time
          description: Last health check timestamp
          example: "2025-11-30T12:00:00Z"
        metadata:
          type: object
          additionalProperties: true
          description: Target-specific metadata


paths:
  # ==========================================================================
  # System Health
  # ==========================================================================
  /health:
    get:
      tags: [System]
      summary: Get system health status
      description: |
        Returns overall system health including component checks (database, Redis, LLM).
        Used by Kubernetes readiness/liveness probes.
      operationId: getHealth
      responses:
        '200':
          description: System health retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "healthy"
                version: "2.0.0"
                uptime_seconds: 86400
                checks:
                  database: "pass"
                  redis: "pass"
                  llm: "pass"

  # ==========================================================================
  # Publishing - Target Management
  # ==========================================================================
  /publishing/targets:
    get:
      tags: [Publishing]
      summary: List all publishing targets
      description: |
        Returns all discovered publishing targets from Kubernetes Secrets.
        Auto-discovers targets with label `publishing-target=true`.
      operationId: listPublishingTargets
      parameters:
        - name: type
          in: query
          description: Filter by target type
          schema:
            type: string
            enum: [slack, pagerduty, rootly, webhook]
        - name: health_status
          in: query
          description: Filter by health status
          schema:
            type: string
            enum: [healthy, degraded, unhealthy]
      responses:
        '200':
          description: Targets retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  targets:
                    type: array
                    items:
                      $ref: '#/components/schemas/PublishingTarget'
                  count:
                    type: integer
              example:
                targets:
                  - name: "slack-engineering"
                    type: "slack"
                    endpoint: "https://hooks.slack.com/..."
                    health_status: "healthy"
                  - name: "pagerduty-oncall"
                    type: "pagerduty"
                    endpoint: "https://events.pagerduty.com/..."
                    health_status: "healthy"
                count: 2

  /publishing/targets/{name}:
    get:
      tags: [Publishing]
      summary: Get target by name
      operationId: getPublishingTarget
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Target name
          example: "slack-engineering"
      responses:
        '200':
          description: Target details retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublishingTarget'
        '404':
          description: Target not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /publishing/targets/refresh:
    post:
      tags: [Publishing]
      summary: Refresh target discovery
      description: |
        Manually trigger target discovery from Kubernetes Secrets.
        Rate limited to 1 request per minute.
      operationId: refreshTargets
      responses:
        '202':
          description: Refresh triggered successfully (async)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Target refresh initiated"
                  status:
                    type: string
                    example: "in_progress"
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /classification/stats:
    get:
      tags: [Classification]
      summary: Get classification statistics
      description: |
        Returns aggregate classification statistics including:
        - Total classifications
        - Cache hit rate (L1 + L2)
        - Average confidence score
        - LLM performance metrics
      operationId: getClassificationStats
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_classifications:
                    type: integer
                    example: 10523
                  cache_hit_rate:
                    type: number
                    format: float
                    example: 0.95
                  avg_confidence:
                    type: number
                    format: float
                    example: 0.87
                  l1_hit_rate:
                    type: number
                    example: 0.65
                  l2_hit_rate:
                    type: number
                    example: 0.30

  /classification/classify:
    post:
      tags: [Classification]
      summary: Classify alert manually
      description: |
        Manually trigger LLM classification for a specific alert.
        Supports cache bypass with `force=true` parameter.
      operationId: classifyAlert
      parameters:
        - name: force
          in: query
          description: Bypass cache and force re-classification
          schema:
            type: boolean
            default: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Alert'
      responses:
        '200':
          description: Classification completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClassificationResult'

  /enrichment/mode:
    get:
      tags: [Enrichment]
      summary: Get current enrichment mode
      operationId: getEnrichmentMode
      responses:
        '200':
          description: Current mode retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  mode:
                    type: string
                    enum: [transparent, enriched, transparent_with_recommendations]
                    example: "enriched"
    post:
      tags: [Enrichment]
      summary: Set enrichment mode
      operationId: setEnrichmentMode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - mode
              properties:
                mode:
                  type: string
                  enum: [transparent, enriched, transparent_with_recommendations]
                  example: "enriched"
      responses:
        '200':
          description: Mode updated successfully
        '400':
          description: Invalid mode
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /history:
    get:
      tags: [History]
      summary: Get alert history with filtering
      description: |
        Returns paginated alert history with advanced filtering options.
        Supports filtering by status, severity, namespace, time range, labels.
      operationId: getHistory
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: status
          in: query
          schema:
            type: string
            enum: [firing, resolved]
        - name: severity
          in: query
          schema:
            type: string
            enum: [critical, warning, info]
        - name: namespace
          in: query
          schema:
            type: string
        - name: from
          in: query
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: History retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HistoryResponse'

    # ============================================================================
    # Core Domain Models
    # ============================================================================
    Alert:
      type: object
      required:
        - fingerprint
        - alert_name
        - status
        - starts_at
      properties:
        id:
          type: integer
          format: int64
          example: 1
        fingerprint:
          type: string
          minLength: 64
          maxLength: 64
          description: SHA-256 fingerprint (64 hex chars)
          example: "a1b2c3d4e5f67890123456789012345678901234567890123456789012345678"
        alert_name:
          type: string
          example: "HighMemoryUsage"
        status:
          type: string
          enum: [firing, resolved]
          example: "firing"
        severity:
          type: string
          enum: [critical, warning, info]
          example: "critical"
        namespace:
          type: string
          example: "production"
        starts_at:
          type: string
          format: date-time
          example: "2025-11-30T12:00:00Z"
        ends_at:
          type: string
          format: date-time
          nullable: true
          example: "2025-11-30T13:00:00Z"
        labels:
          type: object
          additionalProperties:
            type: string
          example:
            alertname: "HighMemoryUsage"
            severity: "critical"
            namespace: "production"
            pod: "api-server-abc123"
        annotations:
          type: object
          additionalProperties:
            type: string
          example:
            summary: "Memory usage at 95%"
            description: "Pod api-server-abc123 memory at 95%"
            runbook_url: "https://runbooks.example.com/memory"
        classification:
          $ref: '#/components/schemas/ClassificationResult'

    ClassificationResult:
      type: object
      description: LLM-powered alert classification result
      properties:
        severity:
          type: string
          enum: [critical, high, medium, low]
          example: "critical"
        category:
          type: string
          example: "Infrastructure"
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 1
          example: 0.92
        reasoning:
          type: string
          example: "High memory usage in production pod indicates potential OOM risk"
        action_items:
          type: array
          items:
            type: string
          example:
            - "Check memory limits in deployment"
            - "Review application memory leaks"
            - "Consider vertical pod autoscaling"
        classified_at:
          type: string
          format: date-time
          example: "2025-11-30T12:00:05Z"
        model:
          type: string
          example: "gpt-4"

    HistoryResponse:
      type: object
      required:
        - alerts
        - total
        - page
        - per_page
      properties:
        alerts:
          type: array
          items:
            $ref: '#/components/schemas/Alert'
        total:
          type: integer
          description: Total number of alerts matching filters
          example: 1523
        page:
          type: integer
          example: 1
        per_page:
          type: integer
          example: 50
        total_pages:
          type: integer
          example: 31
        has_next:
          type: boolean
          example: true
        has_prev:
          type: boolean
          example: false


  /history/recent:
    get:
      tags: [History]
      summary: Get recent alerts
      operationId: getRecentAlerts
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
            maximum: 1000
      responses:
        '200':
          description: Recent alerts retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  alerts:
                    type: array
                    items:
                      $ref: '#/components/schemas/Alert'
                  count:
                    type: integer

  /history/{fingerprint}:
    get:
      tags: [History]
      summary: Get alert timeline by fingerprint
      operationId: getAlertTimeline
      parameters:
        - name: fingerprint
          in: path
          required: true
          schema:
            type: string
            minLength: 64
            maxLength: 64
          example: "a1b2c3d4e5f67890123456789012345678901234567890123456789012345678"
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
            maximum: 1000
      responses:
        '200':
          description: Timeline retrieved
        '400':
          description: Invalid fingerprint
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /history/top:
    get:
      tags: [History]
      summary: Get top firing alerts
      operationId: getTopAlerts
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            maximum: 100
        - name: from
          in: query
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Top alerts retrieved

  /history/flapping:
    get:
      tags: [History]
      summary: Get flapping alerts
      operationId: getFlappingAlerts
      parameters:
        - name: threshold
          in: query
          schema:
            type: integer
            default: 5
            maximum: 100
        - name: from
          in: query
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Flapping alerts retrieved

  /history/stats:
    get:
      tags: [History]
      summary: Get aggregated statistics
      operationId: getAggregatedStats
      responses:
        '200':
          description: Statistics retrieved

  /config:
    get:
      tags: [Configuration]
      summary: Export current configuration
      operationId: getConfig
      responses:
        '200':
          description: Configuration exported
          content:
            application/yaml:
              schema:
                type: string
    post:
      tags: [Configuration]
      summary: Update configuration
      operationId: updateConfig
      requestBody:
        required: true
        content:
          application/yaml:
            schema:
              type: string
      responses:
        '200':
          description: Configuration updated
        '400':
          description: Invalid configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /config/rollback:
    post:
      tags: [Configuration]
      summary: Rollback to previous configuration
      operationId: rollbackConfig
      parameters:
        - name: version
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Rolled back successfully
        '404':
          description: Version not found

  /alerts:
    post:
      tags: [System]
      summary: Receive Prometheus alerts (Alertmanager-compatible)
      description: |
        Alertmanager-compatible webhook endpoint.
        Supports Prometheus Alertmanager v0.25+ format.
      operationId: receiveAlerts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/Alert'
      responses:
        '200':
          description: Alerts received successfully
        '207':
          description: Partial success (some alerts failed)
        '400':
          description: Invalid payload


  /silences:
    get:
      tags: [Silences]
      summary: List silences
      description: Alertmanager-compatible silence listing
      operationId: listSilences
      parameters:
        - name: filter
          in: query
          schema:
            type: array
            items:
              type: string
          description: Filter silences by matcher
      responses:
        '200':
          description: Silences retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Silence'
    post:
      tags: [Silences]
      summary: Create silence
      operationId: createSilence
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SilenceCreate'
      responses:
        '201':
          description: Silence created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Silence'
        '400':
          description: Invalid silence
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /silences/{id}:
    get:
      tags: [Silences]
      summary: Get silence by ID
      operationId: getSilence
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Silence retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Silence'
        '404':
          description: Silence not found
    put:
      tags: [Silences]
      summary: Update silence
      operationId: updateSilence
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SilenceUpdate'
      responses:
        '200':
          description: Silence updated
    delete:
      tags: [Silences]
      summary: Delete silence
      operationId: deleteSilence
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Silence deleted
        '404':
          description: Silence not found

  /silences/check:
    post:
      tags: [Silences]
      summary: Check if alert would be silenced
      operationId: checkSilence
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Alert'
      responses:
        '200':
          description: Check completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  silenced:
                    type: boolean
                  silence_ids:
                    type: array
                    items:
                      type: string

    Silence:
      type: object
      required:
        - id
        - matchers
        - starts_at
        - ends_at
        - created_by
      properties:
        id:
          type: string
          format: uuid
        matchers:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              value:
                type: string
              is_regex:
                type: boolean
        starts_at:
          type: string
          format: date-time
        ends_at:
          type: string
          format: date-time
        comment:
          type: string
        created_by:
          type: string
        status:
          type: string
          enum: [active, pending, expired]

    SilenceCreate:
      type: object
      required:
        - matchers
        - starts_at
        - ends_at
        - created_by
      properties:
        matchers:
          type: array
          items:
            type: object
        starts_at:
          type: string
          format: date-time
        ends_at:
          type: string
          format: date-time
        comment:
          type: string
        created_by:
          type: string


  /inhibition/rules:
    get:
      tags: [Inhibition]
      summary: List loaded inhibition rules
      description: Returns all inhibition rules from configuration
      operationId: getInhibitionRules
      responses:
        '200':
          description: Rules retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  rules:
                    type: array
                    items:
                      type: object
                  count:
                    type: integer

  /inhibition/status:
    get:
      tags: [Inhibition]
      summary: Get active inhibition relationships
      description: Returns current inhibition state (which alerts are inhibiting others)
      operationId: getInhibitionStatus
      responses:
        '200':
          description: Status retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  active_inhibitions:
                    type: integer
                  relationships:
                    type: array
                    items:
                      type: object

  /inhibition/check:
    post:
      tags: [Inhibition]
      summary: Check if alert would be inhibited
      operationId: checkInhibition
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Alert'
      responses:
        '200':
          description: Check completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  inhibited:
                    type: boolean
                  inhibiting_alerts:
                    type: array
                    items:
                      $ref: '#/components/schemas/Alert'

  /dashboard:
    get:
      tags: [Dashboard]
      summary: Render modern dashboard page (HTML)
      description: Server-side rendered dashboard with real-time updates
      operationId: getDashboard
      responses:
        '200':
          description: Dashboard HTML page
          content:
            text/html:
              schema:
                type: string

  /ui/alerts:
    get:
      tags: [Dashboard]
      summary: Alert list page (HTML)
      description: Server-side rendered alert list with filtering
      operationId: getAlertListUI
      parameters:
        - name: status
          in: query
          schema:
            type: string
        - name: severity
          in: query
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Alert list HTML
          content:
            text/html:
              schema:
                type: string

  /api/dashboard/overview:
    get:
      tags: [Dashboard]
      summary: Dashboard overview statistics
      operationId: getDashboardOverview
      responses:
        '200':
          description: Overview statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_alerts:
                    type: integer
                  firing_count:
                    type: integer
                  resolved_count:
                    type: integer
                  avg_resolution_time_seconds:
                    type: number

  /api/dashboard/health:
    get:
      tags: [Dashboard]
      summary: System health summary
      operationId: getDashboardHealth
      responses:
        '200':
          description: Health summary
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [healthy, degraded, unhealthy]
                  components:
                    type: object

  /api/v2/events/stream:
    get:
      tags: [Dashboard]
      summary: Server-Sent Events stream
      description: Real-time alert event stream (SSE)
      operationId: getEventStream
      responses:
        '200':
          description: SSE stream
          content:
            text/event-stream:
              schema:
                type: string

  /ws/dashboard:
    get:
      tags: [Dashboard]
      summary: WebSocket for real-time updates
      description: Dashboard WebSocket connection
      operationId: getDashboardWebSocket
      responses:
        '101':
          description: WebSocket upgrade


  /webhook:
    post:
      tags: [System]
      summary: Universal webhook endpoint
      description: |
        Auto-detects webhook type (Alertmanager, Prometheus, Generic)
        and routes to appropriate handler.
        Backward compatible with legacy webhook format.
      operationId: receiveWebhook
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/Alert'
                - type: array
                  items:
                    $ref: '#/components/schemas/Alert'
      responses:
        '200':
          description: Webhook processed
        '207':
          description: Partial success
        '400':
          description: Invalid payload

  /webhook/proxy:
    post:
      tags: [System]
      summary: Intelligent webhook proxy
      description: |
        Explicit intelligent proxy with:
        - LLM classification
        - Advanced filtering
        - Multi-target publishing
      operationId: proxyWebhook
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/Alert'
      responses:
        '200':
          description: Alerts processed and published

  /publishing/queue/status:
    get:
      tags: [Publishing]
      summary: Get queue status
      operationId: getQueueStatus
      responses:
        '200':
          description: Queue status retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  pending:
                    type: integer
                  processing:
                    type: integer
                  completed_total:
                    type: integer
                  failed_total:
                    type: integer

  /publishing/queue/stats:
    get:
      tags: [Publishing]
      summary: Get detailed queue statistics
      operationId: getQueueStats
      responses:
        '200':
          description: Statistics retrieved

  /publishing/queue/submit:
    post:
      tags: [Publishing]
      summary: Submit alert to publishing queue
      operationId: submitToQueue
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - alert
                - targets
              properties:
                alert:
                  $ref: '#/components/schemas/Alert'
                targets:
                  type: array
                  items:
                    type: string
                priority:
                  type: string
                  enum: [high, normal, low]
      responses:
        '202':
          description: Job submitted
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id:
                    type: string
                  status:
                    type: string

  /publishing/queue/jobs:
    get:
      tags: [Publishing]
      summary: List queue jobs
      operationId: listQueueJobs
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, processing, completed, failed]
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: Jobs retrieved

  /publishing/queue/jobs/{id}:
    get:
      tags: [Publishing]
      summary: Get job by ID
      operationId: getQueueJob
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Job details
        '404':
          description: Job not found

  /publishing/dlq:
    get:
      tags: [Publishing]
      summary: List Dead Letter Queue entries
      operationId: listDLQ
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: DLQ entries retrieved

  /publishing/dlq/{id}/replay:
    post:
      tags: [Publishing]
      summary: Replay DLQ entry
      operationId: replayDLQEntry
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '202':
          description: Replay initiated
        '404':
          description: Entry not found

  /publishing/dlq/purge:
    delete:
      tags: [Publishing]
      summary: Purge old DLQ entries
      operationId: purgeDLQ
      parameters:
        - name: older_than
          in: query
          schema:
            type: string
            format: date-time
          description: Delete entries older than this timestamp
      responses:
        '200':
          description: Purge completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  deleted_count:
                    type: integer

  /metrics:
    get:
      tags: [System]
      summary: Prometheus metrics endpoint
      description: Exposes metrics in Prometheus format
      operationId: getPrometheusMetrics
      responses:
        '200':
          description: Metrics in Prometheus format
          content:
            text/plain:
              schema:
                type: string


  /publishing/parallel/targets:
    post:
      tags: [Publishing]
      summary: Publish to specific targets (parallel)
      operationId: publishParallelTargets
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                alert:
                  $ref: '#/components/schemas/Alert'
                targets:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Published successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  successful:
                    type: integer
                  failed:
                    type: integer
                  results:
                    type: array

  /publishing/parallel/all:
    post:
      tags: [Publishing]
      summary: Publish to all targets (parallel)
      operationId: publishParallelAll
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                alert:
                  $ref: '#/components/schemas/Alert'
      responses:
        '200':
          description: Published to all targets

  /publishing/parallel/healthy:
    post:
      tags: [Publishing]
      summary: Publish to healthy targets only
      operationId: publishParallelHealthy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                alert:
                  $ref: '#/components/schemas/Alert'
      responses:
        '200':
          description: Published to healthy targets

  /publishing/stats:
    get:
      tags: [Publishing]
      summary: Get publishing statistics
      operationId: getPublishingStats
      responses:
        '200':
          description: Statistics retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_published:
                    type: integer
                  successful:
                    type: integer
                  failed:
                    type: integer
                  by_target:
                    type: object
                    additionalProperties:
                      type: integer

  /publishing/mode:
    get:
      tags: [Publishing]
      summary: Get publishing mode
      operationId: getPublishingMode
      responses:
        '200':
          description: Mode retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  mode:
                    type: string
                    enum: [active, metrics_only]

    SilenceUpdate:
      type: object
      properties:
        matchers:
          type: array
          items:
            type: object
        ends_at:
          type: string
          format: date-time
        comment:
          type: string


# ==============================================================================
# Additional Response Examples
# ==============================================================================
# This section demonstrates comprehensive request/response examples

# Example: Classification Response
# POST /classification/classify
# Response:
#   {
#     "severity": "critical",
#     "category": "Infrastructure",
#     "confidence": 0.92,
#     "reasoning": "High memory usage in production pod indicates potential OOM risk",
#     "action_items": [
#       "Check memory limits in deployment",
#       "Review application memory leaks",
#       "Consider vertical pod autoscaling"
#     ],
#     "classified_at": "2025-11-30T12:00:05Z",
#     "model": "gpt-4"
#   }

# Example: Publishing Stats Response
# GET /publishing/stats
# Response:
#   {
#     "total_published": 15234,
#     "successful": 15100,
#     "failed": 134,
#     "by_target": {
#       "slack-engineering": 5000,
#       "pagerduty-oncall": 4500,
#       "webhook-general": 5600
#     }
#   }

# Example: Silence Response
# GET /silences/{id}
# Response:
#   {
#     "id": "550e8400-e29b-41d4-a716-446655440000",
#     "matchers": [
#       {"name": "alertname", "value": "HighMemoryUsage", "is_regex": false},
#       {"name": "namespace", "value": "production", "is_regex": false}
#     ],
#     "starts_at": "2025-11-30T12:00:00Z",
#     "ends_at": "2025-12-01T12:00:00Z",
#     "comment": "Maintenance window",
#     "created_by": "ops-team",
#     "status": "active"
#   }
