# TN-14: –°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (goose)

## üéØ **–¶–µ–ª—å –∑–∞–¥–∞—á–∏**

–°–æ–∑–¥–∞—Ç—å production-ready —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º goose, –∫–æ—Ç–æ—Ä–∞—è –æ–±–µ—Å–ø–µ—á–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö.

## üìã **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**

### **1. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö**
- [ ] **PostgreSQL**: –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **SQLite**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SQLite –¥–ª—è development –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] **Multi-driver**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –¥—Ä–∞–π–≤–µ—Ä–∞–º–∏
- [ ] **Driver abstraction**: –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

### **2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏**
- [ ] **Create migration**: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- [ ] **Up migration**: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (up)
- [ ] **Down migration**: –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π (down)
- [ ] **Status check**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Version control**: –ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π –º–∏–≥—Ä–∞—Ü–∏–π

### **3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å**
- [ ] **Transaction safety**: –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- [ ] **Rollback capability**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- [ ] **Dry-run mode**: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Backup integration**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å backup –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- [ ] **Timeout control**: –ö–æ–Ω—Ç—Ä–æ–ª—å –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### **4. Development experience**
- [ ] **Auto-migration**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (dev)
- [ ] **Migration templates**: –®–∞–±–ª–æ–Ω—ã –¥–ª—è –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Verbose logging**: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
- [ ] **Migration history**: –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Conflict detection**: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–π

### **5. CI/CD Integration**
- [ ] **Migration validation**: –í–∞–ª–∏–¥–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –≤ CI
- [ ] **Schema diff**: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ö–µ–º –º–µ–∂–¥—É –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏
- [ ] **Migration testing**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Rollback testing**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–∞—Ç–æ–≤
- [ ] **Deployment safety**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### **6. Monitoring –∏ observability**
- [ ] **Migration metrics**: –ú–µ—Ç—Ä–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Error reporting**: –û—Ç—á–µ—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Performance monitoring**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] **Audit logging**: –ê—É–¥–∏—Ç –ª–æ–≥–æ–≤ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] **Health checks**: –ü—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π

## üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**

### **Goose Integration**

#### **–ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**
```go
type MigrationConfig struct {
    Driver          string        // "postgres" –∏–ª–∏ "sqlite"
    DSN            string        // Connection string
    Dir            string        // –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π (default: "migrations")
    Table          string        // –¢–∞–±–ª–∏—Ü–∞ –≤–µ—Ä—Å–∏–π (default: "goose_db_version")
    Verbose        bool          // –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    NoVersioning   bool          // –û—Ç–∫–ª—é—á–∏—Ç—å versioning (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)
    Timeout        time.Duration // –¢–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
}

type MigrationManager struct {
    config *MigrationConfig
    goose  *goose.Provider
    logger *slog.Logger
}
```

#### **–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã**
```go
func NewMigrationManager(config *MigrationConfig) (*MigrationManager, error)

func (mm *MigrationManager) Up(ctx context.Context) error
func (mm *MigrationManager) UpTo(ctx context.Context, version int64) error
func (mm *MigrationManager) UpByOne(ctx context.Context) error

func (mm *MigrationManager) Down(ctx context.Context) error
func (mm *MigrationManager) DownTo(ctx context.Context, version int64) error

func (mm *MigrationManager) Status(ctx context.Context) ([]*MigrationStatus, error)
func (mm *MigrationManager) Version(ctx context.Context) (int64, error)

func (mm *MigrationManager) Create(ctx context.Context, name string) (string, error)
func (mm *MigrationManager) Validate(ctx context.Context) error
```

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–π**

#### **–§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
```
migrations/
‚îú‚îÄ‚îÄ 20250101120000_initial_schema.sql
‚îú‚îÄ‚îÄ 20250101120100_add_indexes.sql
‚îú‚îÄ‚îÄ 20250101120200_add_constraints.sql
‚îú‚îÄ‚îÄ 20250102120000_add_alerts_table.sql
‚îú‚îÄ‚îÄ 20250102120100_add_classifications.sql
‚îî‚îÄ‚îÄ 20250102120200_add_publishing_logs.sql
```

#### **–§–æ—Ä–º–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π**
```sql
-- +goose Up
-- SQL –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

CREATE TABLE IF NOT EXISTS alerts (
    id TEXT PRIMARY KEY,
    alert_name TEXT NOT NULL,
    status TEXT NOT NULL,
    labels TEXT,
    annotations TEXT,
    starts_at TIMESTAMP NOT NULL,
    ends_at TIMESTAMP,
    generator_url TEXT,
    timestamp TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- +goose Down
-- SQL –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–∫–∞—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

DROP TABLE IF EXISTS alerts;
```

### **Migration Templates**

#### **–®–∞–±–ª–æ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–π**
```sql
-- Template: create_table.sql
-- +goose Up
CREATE TABLE {table_name} (
    id SERIAL PRIMARY KEY,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- +goose Down
DROP TABLE IF EXISTS {table_name};

-- Template: add_column.sql
-- +goose Up
ALTER TABLE {table_name} ADD COLUMN {column_name} {column_type};

-- +goose Down
ALTER TABLE {table_name} DROP COLUMN IF EXISTS {column_name};

-- Template: create_index.sql
-- +goose Up
CREATE INDEX CONCURRENTLY idx_{table_name}_{column_name} ON {table_name}({column_name});

-- +goose Down
DROP INDEX IF EXISTS idx_{table_name}_{column_name};
```

## ‚úÖ **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**

### **Core Functionality**
- [ ] **Migration execution**: Up/Down –º–∏–≥—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] **Status tracking**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Version control**: –ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Error handling**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [ ] **Transaction safety**: –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö

### **Development Experience**
- [ ] **Easy setup**: –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- [ ] **Auto-migration**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ dev
- [ ] **Migration creation**: –£–¥–æ–±–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Verbose logging**: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
- [ ] **Conflict resolution**: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

### **Production Readiness**
- [ ] **Rollback capability**: –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Timeout handling**: –ö–æ–Ω—Ç—Ä–æ–ª—å –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- [ ] **Dry-run support**: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- [ ] **Backup integration**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å backup
- [ ] **Monitoring**: –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **Testing & Validation**
- [ ] **Migration testing**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Rollback testing**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–∞—Ç–æ–≤
- [ ] **Schema validation**: –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Data integrity**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] **Performance testing**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### **CI/CD Integration**
- [ ] **CI validation**: –í–∞–ª–∏–¥–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –≤ CI
- [ ] **Schema diff**: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ö–µ–º
- [ ] **Automated testing**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] **Deployment safety**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- [ ] **Audit logging**: –ê—É–¥–∏—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üöÄ **Implementation Plan**

### **Phase 1: Core Migration System (3 –¥–Ω—è)**
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ goose –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ (up, down, status)
3. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### **Phase 2: Advanced Features (3 –¥–Ω—è)**
1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è rollback capability
2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ dry-run —Ä–µ–∂–∏–º–∞
3. –°–æ–∑–¥–∞–Ω–∏–µ migration templates
4. Verbose logging –∏ monitoring

### **Phase 3: Development Integration (2 –¥–Ω—è)**
1. Auto-migration –¥–ª—è development
2. Migration creation tools
3. Conflict detection
4. Development helpers

### **Phase 4: Production Safety (3 –¥–Ω—è)**
1. Transaction safety improvements
2. Timeout handling
3. Backup integration
4. Production deployment procedures

### **Phase 5: Testing & Validation (2 –¥–Ω—è)**
1. Comprehensive testing
2. Performance testing
3. CI/CD integration
4. Documentation

### **Phase 6: Monitoring & Observability (2 –¥–Ω—è)**
1. Migration metrics
2. Error reporting
3. Audit logging
4. Health checks

## üìä **–ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞**

### **Performance Metrics**
- **Migration time**: < 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- **Rollback time**: < 60 —Å–µ–∫—É–Ω–¥ –¥–ª—è –æ—Ç–∫–∞—Ç–æ–≤
- **Memory usage**: < 50MB –≤–æ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–π
- **CPU usage**: < 20% –∑–∞–≥—Ä—É–∑–∫–∏ CPU

### **Reliability Metrics**
- **Success rate**: > 99.9% —É—Å–ø–µ—à–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- **Rollback success**: > 95% —É—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–∫–∞—Ç–æ–≤
- **Data integrity**: 100% —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- **Zero downtime**: –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è —Å–µ—Ä–≤–∏—Å–∞

### **Developer Experience**
- **Setup time**: < 5 –º–∏–Ω—É—Ç –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- **Migration creation**: < 2 –º–∏–Ω—É—Ç—ã –Ω–∞ –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
- **Debug visibility**: 100% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞
- **Error clarity**: –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### **Operational Excellence**
- **Monitoring coverage**: 100% –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫
- **Alert coverage**: 100% –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- **Documentation**: 100% –ø—Ä–æ—Ü–µ–¥—É—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ
- **Training**: 100% –∫–æ–º–∞–Ω–¥—ã –æ–±—É—á–µ–Ω—ã

## üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ compliance**

### **Data Safety**
- [ ] **Backup before migration**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- [ ] **Transaction wrapping**: –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- [ ] **Rollback procedures**: –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –æ—Ç–∫–∞—Ç–∞
- [ ] **Data validation**: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π

### **Access Control**
- [ ] **Migration permissions**: –°—Ç—Ä–æ–≥–∏–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Environment isolation**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ dev/staging/production
- [ ] **Audit logging**: –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] **Approval workflows**: –ü—Ä–æ—Ü–µ—Å—Å—ã —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –¥–ª—è production

### **Monitoring & Alerting**
- [ ] **Migration alerts**: –û–ø–æ–≤–µ—â–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Error alerts**: –û–ø–æ–≤–µ—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] **Performance alerts**: –û–ø–æ–≤–µ—â–µ–Ω–∏—è –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] **Security alerts**: –û–ø–æ–≤–µ—â–µ–Ω–∏—è –æ security issues

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

### **Unit Tests**
```go
func TestMigrationManager_Up(t *testing.T) {
    mm := setupTestMigrationManager(t)
    defer mm.cleanup()

    err := mm.Up(context.Background())
    assert.NoError(t, err)

    version, err := mm.Version(context.Background())
    assert.NoError(t, err)
    assert.Greater(t, version, int64(0))
}

func TestMigrationManager_Down(t *testing.T) {
    mm := setupTestMigrationManager(t)
    defer mm.cleanup()

    // First apply migrations
    err := mm.Up(context.Background())
    require.NoError(t, err)

    // Then rollback
    err = mm.Down(context.Background())
    assert.NoError(t, err)

    version, err := mm.Version(context.Background())
    assert.NoError(t, err)
    assert.Equal(t, int64(0), version)
}
```

### **Integration Tests**
```go
func TestMigrationManager_PostgreSQL(t *testing.T) {
    if testing.Short() {
        t.Skip("Skipping integration test")
    }

    mm := setupPostgreSQLMigrationManager(t)
    defer mm.cleanup()

    ctx := context.Background()

    // Test full migration cycle
    err := mm.Up(ctx)
    require.NoError(t, err)

    status, err := mm.Status(ctx)
    require.NoError(t, err)
    assert.True(t, len(status) > 0)

    // Verify schema
    err = mm.Validate(ctx)
    assert.NoError(t, err)
}

func TestMigrationManager_SQLite(t *testing.T) {
    mm := setupSQLiteMigrationManager(t)
    defer mm.cleanup()

    ctx := context.Background()

    // Test SQLite migrations
    err := mm.Up(ctx)
    require.NoError(t, err)

    // Verify SQLite schema
    err = mm.Validate(ctx)
    assert.NoError(t, err)
}
```

### **Performance Tests**
```go
func BenchmarkMigrationManager_Up(b *testing.B) {
    mm := setupBenchmarkMigrationManager(b)
    defer mm.cleanup()

    b.ResetTimer()

    for i := 0; i < b.N; i++ {
        mm.reset() // Reset to initial state

        err := mm.Up(context.Background())
        require.NoError(b, err)
    }
}

func BenchmarkMigrationManager_Status(b *testing.B) {
    mm := setupBenchmarkMigrationManager(b)
    defer mm.cleanup()

    // Apply migrations first
    err := mm.Up(context.Background())
    require.NoError(b, err)

    b.ResetTimer()

    for i := 0; i < b.N; i++ {
        _, err := mm.Status(context.Background())
        require.NoError(b, err)
    }
}
```

## üìã **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

### **Development Usage**
```go
// Auto-migration on startup
config := &MigrationConfig{
    Driver:    "sqlite",
    DSN:       "./dev.db",
    Dir:       "./migrations",
    Verbose:   true,
}

mm, err := NewMigrationManager(config)
if err != nil {
    log.Fatal(err)
}

// Auto-apply migrations in development
if err := mm.Up(context.Background()); err != nil {
    log.Fatal("Failed to apply migrations:", err)
}
```

### **Production Usage**
```go
// Production migration with safety checks
config := &MigrationConfig{
    Driver:  "postgres",
    DSN:     "postgres://user:pass@host:5432/db",
    Dir:     "./migrations",
    Timeout: 5 * time.Minute,
}

mm, err := NewMigrationManager(config)
if err != nil {
    log.Fatal(err)
}

ctx := context.Background()

// Backup before migration
if err := createBackup(ctx); err != nil {
    log.Fatal("Failed to create backup:", err)
}

// Dry run first
if err := mm.Validate(ctx); err != nil {
    log.Fatal("Migration validation failed:", err)
}

// Apply migrations
if err := mm.Up(ctx); err != nil {
    log.Error("Migration failed, attempting rollback:", err)

    if rollbackErr := mm.Down(ctx); rollbackErr != nil {
        log.Fatal("Rollback also failed:", rollbackErr)
    }

    log.Fatal("Migration and rollback failed")
}
```

### **CLI Usage**
```bash
# Create new migration
goose -dir migrations create add_user_table sql

# Check status
goose -dir migrations postgres "user=postgres dbname=test" status

# Apply migrations
goose -dir migrations postgres "user=postgres dbname=test" up

# Rollback last migration
goose -dir migrations postgres "user=postgres dbname=test" down

# Go to specific version
goose -dir migrations postgres "user=postgres dbname=test" up-to 20250101120000
```

## üéØ **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**

### **Deliverables**
- ‚úÖ **Migration Manager**: –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ **Goose Integration**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å goose framework
- ‚úÖ **Multi-Driver Support**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL –∏ SQLite
- ‚úÖ **Safety Features**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- ‚úÖ **Development Tools**: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚úÖ **Production Ready**: –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production

### **Key Benefits**
- üöÄ **Automated Schema Management**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–æ–π
- üõ°Ô∏è **Production Safe**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è production deployment
- üß™ **Test Ready**: –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- üìä **Observable**: –ü–æ–ª–Ω–∞—è –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞
- üîÑ **Reversible**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚ö° **Fast**: –ë—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

### **Usage Scenarios**
- **Development**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- **Testing**: –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **CI/CD**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- **Production**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **Rollback**: –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

## üéâ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**

**–°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π - —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö!**

### **üéØ Mission:**
- **Schema Evolution**: –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ —Å—Ö–µ–º—ã
- **Zero Downtime**: –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è —Å–µ—Ä–≤–∏—Å–∞
- **Data Safety**: –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- **Developer Productivity**: –£–¥–æ–±—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **Production Reliability**: –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –≤ production

### **üìä Impact:**
- **Deployment Safety**: +300% –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π
- **Rollback Speed**: -80% –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –æ—Ç–∫–∞—Ç
- **Developer Velocity**: +150% —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **Data Integrity**: 100% –≥–∞—Ä–∞–Ω—Ç–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- **Monitoring**: –ü–æ–ª–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞

### **üöÄ Ready for:**
- **Schema Changes**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ —Å—Ö–µ–º—ã
- **Multi-Environment**: –†–∞–±–æ—Ç–∞ –≤ dev/staging/production
- **Team Collaboration**: –°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- **Automated Deployments**: CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- **Disaster Recovery**: –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

**Migration system —Å—Ç–∞–Ω–µ—Ç backbone –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è Alert History!** üöÄ‚ú®
