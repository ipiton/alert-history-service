# TN-19: Loader конфигурации (viper) — План работ

Статус: [ ] НЕ НАЧАТО / [x] В ПРОЦЕССЕ / [ ] ГОТОВО

## Чеклист реализации

1) Документация
- [x] Создать requirements.md
- [x] Создать design.md
- [ ] Обновить общий список задач (tasks.md) статуса TN-19 после завершения

2) Интеграция загрузчика конфигурации
- [x] Подключить `internal/config` в `cmd/server/main.go`
- [x] Добавить флаг `-config` и поддержку `CONFIG_FILE`
- [x] Приоритет источников: defaults < файл < env
- [x] Применить `cfg.Log.Level` к `slog` уровню
- [x] Маппинг `cfg.Database` → `postgres.PostgresConfig`
- [x] Использовать таймауты сервера из `cfg.Server`
- [ ] Если указан `-config` и файл отсутствует — завершать с ошибкой (явное требование TN-19)

3) Тесты для `internal/config`
- [ ] Defaults: `LoadConfigFromEnv()` без файла и окружения возвращает дефолты
- [ ] File: `LoadConfig(path)` с временным YAML загружает значения из файла
- [ ] Env override: переменные окружения перекрывают значения файла
- [ ] Validation: невалидные значения приводят к ошибке
- [ ] Изоляция: сбрасывать env и состояние viper между тестами

4) Примеры/пример запуска
- [ ] Проверить, что `go run ./cmd/server -help` выводит инструкцию по конфигу
- [ ] Проверить запуск с `CONFIG_FILE=go-app/config.yaml` и с `-config go-app/config.yaml`

5) CI/Линтеры
- [ ] Убедиться, что `go test ./...` проходит локально
- [ ] Линтеры (golangci-lint) не выдают ошибок

## Примечания
- На этом этапе (TN-19) логирование оставляем на уровне применения `log.level` для `slog`. Расширение логирования (формат/вывод/ротация) — TN-20.
- Загрузка файла конфигурации через `-config` при его отсутствии должна приводить к немедленной ошибке старта. При авто-поиске `./config.yaml` отсутствие файла не считается ошибкой.
