apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "alert-history.fullname" . }}-config
  namespace: {{ .Values.namespace | default .Release.Namespace }}
  labels:
    {{- include "alert-history.labels" . | nindent 4 }}
data:
  # Application Configuration
  environment: {{ .Values.environment | quote }}
  log-level: {{ .Values.logLevel | quote }}

  # Alert Processing Configuration
  retention-days: {{ .Values.alerts.retentionDays | quote }}
  alert-batch-size: {{ .Values.alerts.batchSize | quote }}
  max-concurrent-alerts: {{ .Values.alerts.maxConcurrentAlerts | quote }}
  enable-classification: {{ .Values.alerts.enableClassification | quote }}

  {{- if .Values.llm.enabled }}
  # LLM Configuration (non-sensitive)
  llm-proxy-url: {{ .Values.llm.proxyUrl | quote }}
  llm-model: {{ .Values.llm.model | quote }}
  llm-timeout: {{ .Values.llm.timeout | quote }}
  llm-max-retries: {{ .Values.llm.maxRetries | quote }}
  llm-retry-delay: {{ .Values.llm.retryDelay | quote }}
  llm-cache-ttl: {{ .Values.llm.cacheTtl | quote }}
  {{- end }}

  # Migration Configuration
  {{- if .Values.migration.enabled }}
  migration-enabled: "true"
  auto-migrate: {{ .Values.migration.autoMigrate | quote }}
  migration-batch-size: {{ .Values.migration.batchSize | quote }}
  verify-migration-data: {{ .Values.migration.verifyData | quote }}
  backup-before-migration: {{ .Values.migration.backupBeforeMigration | quote }}
  {{- end }}

  # Monitoring Configuration
  prometheus-enabled: {{ .Values.monitoring.prometheusEnabled | quote }}
  metrics-port: {{ .Values.service.metricsPort | default 9090 | quote }}
  health-check-interval: {{ .Values.monitoring.healthCheckInterval | quote }}

  # Target Discovery Configuration
  {{- if .Values.targetDiscovery.enabled }}
  target-discovery-enabled: "true"
  target-discovery-namespaces: {{ join "," .Values.targetDiscovery.namespaces | quote }}
  target-discovery-labels: {{ join "," .Values.targetDiscovery.labels | quote }}
  target-discovery-refresh-interval: {{ .Values.targetDiscovery.refreshInterval | quote }}
  {{- end }}

  # Publishing Configuration
  {{- if .Values.publishing.enabled }}
  publishing-enabled: "true"
  publishing-max-concurrent: {{ .Values.publishing.maxConcurrent | quote }}
  publishing-timeout: {{ .Values.publishing.timeout | quote }}
  publishing-retries: {{ .Values.publishing.retries | quote }}
  {{- end }}

  # Filter Configuration
  {{- if .Values.filters }}
  {{- range $key, $value := .Values.filters }}
  filter-{{ $key }}: {{ $value | quote }}
  {{- end }}
  {{- end }}
