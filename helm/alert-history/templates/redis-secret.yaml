{{- if eq .Values.profile "standard" }}
{{- if not .Values.valkey.password.existingSecret }}
{{/*
Redis Secret for Password Authentication
Creates Secret only if existingSecret is not provided
*/}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "alert-history.fullname" . }}-redis-secret
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "alert-history.labels" . | nindent 4 }}
    app.kubernetes.io/component: redis-secret
  annotations:
    # Secret description
    description: "Redis password for authentication"
type: Opaque
data:
  # Password (Base64 encoded)
  # Priority:
  # 1. Use values.valkey.password.value if provided
  # 2. Otherwise generate random 32-character password
  {{- if .Values.valkey.password.value }}
  password: {{ .Values.valkey.password.value | b64enc | quote }}
  {{- else }}
  password: {{ randAlphaNum 32 | b64enc | quote }}
  {{- end }}
{{- end }}
{{- end }}
