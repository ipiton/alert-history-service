{{/* TN-79: Filter Sidebar Partial */}}
{{ define "partials/filter-sidebar" }}
{{ $filters := . }}
<div class="filter-content">
  <!-- Status Filter -->
  <div class="filter-group">
    <label for="filter-status" class="filter-label">Status</label>
    <select id="filter-status" name="status" onchange="applyFilter('status', this.value)" aria-label="Filter by status">
      <option value="">All</option>
      <option value="firing" {{ if and $filters.Status (eq (printf "%s" $filters.Status) "firing") }}selected{{ end }}>Firing</option>
      <option value="resolved" {{ if and $filters.Status (eq (printf "%s" $filters.Status) "resolved") }}selected{{ end }}>Resolved</option>
    </select>
  </div>

  <!-- Severity Filter -->
  <div class="filter-group">
    <label for="filter-severity" class="filter-label">Severity</label>
    <select id="filter-severity" name="severity" onchange="applyFilter('severity', this.value)" aria-label="Filter by severity">
      <option value="">All</option>
      <option value="critical" {{ if and $filters.Severity (eq $filters.Severity "critical") }}selected{{ end }}>Critical</option>
      <option value="warning" {{ if and $filters.Severity (eq $filters.Severity "warning") }}selected{{ end }}>Warning</option>
      <option value="info" {{ if and $filters.Severity (eq $filters.Severity "info") }}selected{{ end }}>Info</option>
      <option value="noise" {{ if and $filters.Severity (eq $filters.Severity "noise") }}selected{{ end }}>Noise</option>
    </select>
  </div>

  <!-- Namespace Filter -->
  <div class="filter-group">
    <label for="filter-namespace" class="filter-label">Namespace</label>
    <input type="text" id="filter-namespace" name="namespace" value="{{ if $filters.Namespace }}{{ $filters.Namespace }}{{ end }}"
           placeholder="Enter namespace..."
           onchange="applyFilter('namespace', this.value)"
           aria-label="Filter by namespace">
  </div>

  <!-- Time Range Filter -->
  <div class="filter-group">
    <label class="filter-label">Time Range</label>
    <div class="time-range-inputs">
      <label for="filter-from" class="sr-only">From</label>
      <input type="datetime-local" id="filter-from" name="from"
             value="{{ if $filters.TimeRange }}{{ if $filters.TimeRange.From }}{{ formatDateTime $filters.TimeRange.From }}{{ end }}{{ end }}"
             onchange="applyTimeFilter()"
             aria-label="Filter from date">
      <label for="filter-to" class="sr-only">To</label>
      <input type="datetime-local" id="filter-to" name="to"
             value="{{ if $filters.TimeRange }}{{ if $filters.TimeRange.To }}{{ formatDateTime $filters.TimeRange.To }}{{ end }}{{ end }}"
             onchange="applyTimeFilter()"
             aria-label="Filter to date">
    </div>
  </div>

  <!-- Filter Presets -->
  <div class="filter-group">
    <label class="filter-label">Quick Filters</label>
    <div class="filter-presets">
      <button class="btn-preset" onclick="applyPreset('last-1h')" aria-label="Last 1 hour">Last 1h</button>
      <button class="btn-preset" onclick="applyPreset('last-24h')" aria-label="Last 24 hours">Last 24h</button>
      <button class="btn-preset" onclick="applyPreset('last-7d')" aria-label="Last 7 days">Last 7d</button>
      <button class="btn-preset" onclick="applyPreset('critical-only')" aria-label="Critical only">Critical Only</button>
    </div>
  </div>

  <!-- Search Filter -->
  <div class="filter-group">
    <label for="filter-search" class="filter-label">Search</label>
    <input type="text" id="filter-search" name="search"
           value="{{ if $filters.Search }}{{ $filters.Search }}{{ end }}"
           placeholder="Search alerts..."
           onchange="applyFilter('search', this.value)"
           aria-label="Search alerts">
  </div>
</div>

<script>
// Apply Filter
function applyFilter(name, value) {
  const url = new URL(window.location);
  if (value) {
    url.searchParams.set(name, value);
  } else {
    url.searchParams.delete(name);
  }
  window.location.href = url.toString();
}

// Apply Time Filter
function applyTimeFilter() {
  const from = document.getElementById('filter-from').value;
  const to = document.getElementById('filter-to').value;
  const url = new URL(window.location);

  if (from) {
    url.searchParams.set('from', new Date(from).toISOString());
  } else {
    url.searchParams.delete('from');
  }

  if (to) {
    url.searchParams.set('to', new Date(to).toISOString());
  } else {
    url.searchParams.delete('to');
  }

  window.location.href = url.toString();
}

// Apply Preset
function applyPreset(preset) {
  const url = new URL(window.location);
  const now = new Date();

  switch(preset) {
    case 'last-1h':
      url.searchParams.set('from', new Date(now.getTime() - 60*60*1000).toISOString());
      break;
    case 'last-24h':
      url.searchParams.set('from', new Date(now.getTime() - 24*60*60*1000).toISOString());
      break;
    case 'last-7d':
      url.searchParams.set('from', new Date(now.getTime() - 7*24*60*60*1000).toISOString());
      break;
    case 'critical-only':
      url.searchParams.set('severity', 'critical');
      break;
  }

  window.location.href = url.toString();
}
</script>
{{ end }}
