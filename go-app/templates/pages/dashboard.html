{{/* TN-77: Modern Dashboard Page (150% Quality Target) */}}
{{ define "title" }}Dashboard - Alertmanager++{{ end }}

{{ define "content" }}
<div class="dashboard-page">
  <!-- Page Header -->
  <div class="page-header">
    <h1>Dashboard</h1>
    <div class="header-actions">
      <button class="btn btn-secondary" onclick="location.reload()">
        ğŸ”„ Refresh
      </button>
      <a href="/ui/silences/create" class="btn btn-primary">
        ğŸ”• Create Silence
      </a>
    </div>
  </div>

  <!-- Dashboard Grid (CSS Grid Layout) -->
  <div class="dashboard-grid">

    <!-- Section 1: Stats Overview (Row 1, Full Width) -->
    <section class="stats-section" aria-labelledby="stats-heading">
      <h2 id="stats-heading" class="sr-only">Alert Statistics</h2>
      <div class="stats-grid">
        {{ template "partials/stats-card" (dict "Icon" "ğŸ”¥" "Value" (default 0 .Data.FiringAlerts) "Label" "Firing Alerts" "Severity" "critical") }}
        {{ template "partials/stats-card" (dict "Icon" "âœ…" "Value" (default 0 .Data.ResolvedAlerts) "Label" "Resolved Today") }}
        {{ template "partials/stats-card" (dict "Icon" "ğŸ”•" "Value" (default 0 .Data.ActiveSilences) "Label" "Active Silences") }}
        {{ template "partials/stats-card" (dict "Icon" "ğŸ¯" "Value" (default 0 .Data.InhibitedAlerts) "Label" "Inhibited Alerts") }}
      </div>
    </section>

    <!-- Section 2: Recent Alerts (Row 2, Left 60% on desktop) -->
    <section class="alerts-section" aria-labelledby="alerts-heading">
      <div class="section-header">
        <h2 id="alerts-heading">Recent Alerts</h2>
        <a href="/ui/alerts" class="view-all-link">View All â†’</a>
      </div>
      {{ if .Data.RecentAlerts }}
      <div class="alert-feed" role="list">
        {{ range .Data.RecentAlerts }}
          {{ template "partials/alert-card" . }}
        {{ end }}
      </div>
      {{ else }}
      <div class="empty-state">
        <div class="empty-icon">ğŸ“­</div>
        <p>No recent alerts</p>
      </div>
      {{ end }}
    </section>

    <!-- Section 3: Active Silences (Row 2, Right 40% on desktop) -->
    <section class="silences-section" aria-labelledby="silences-heading">
      <div class="section-header">
        <h2 id="silences-heading">Active Silences</h2>
        <a href="/ui/silences" class="view-all-link">View All â†’</a>
      </div>
      {{ if .Data.ActiveSilencesList }}
      <div class="silence-feed" role="list">
        {{ range .Data.ActiveSilencesList }}
          {{ template "partials/silence-card" . }}
        {{ end }}
      </div>
      {{ else }}
      <div class="empty-state">
        <div class="empty-icon">ğŸ”•</div>
        <p>No active silences</p>
      </div>
      {{ end }}
    </section>

    <!-- Section 4: Alert Timeline (Row 3, Full Width) -->
    <section class="timeline-section" aria-labelledby="timeline-heading">
      <div class="section-header">
        <h2 id="timeline-heading">Alert Timeline (24h)</h2>
      </div>
      {{ if .Data.AlertTimeline }}
        {{ template "partials/timeline-chart" .Data.AlertTimeline }}
      {{ else }}
      <div class="empty-state">
        <div class="empty-icon">ğŸ“Š</div>
        <p>Timeline data unavailable</p>
      </div>
      {{ end }}
    </section>

    <!-- Section 5: System Health (Row 4, Left 50% on desktop) -->
    <section class="health-section" aria-labelledby="health-heading">
      <div class="section-header">
        <h2 id="health-heading">System Health</h2>
      </div>
      {{ if .Data.Health }}
        {{ template "partials/health-panel" .Data.Health }}
      {{ else }}
      <div class="empty-state">
        <div class="empty-icon">ğŸ¥</div>
        <p>Health data unavailable</p>
      </div>
      {{ end }}
    </section>

    <!-- Section 6: Quick Actions (Row 4, Right 50% on desktop) -->
    <section class="actions-section" aria-labelledby="actions-heading">
      <div class="section-header">
        <h2 id="actions-heading">Quick Actions</h2>
      </div>
      {{ template "partials/quick-actions" . }}
    </section>

  </div>
</div>
{{ end }}

{{ define "extra_css" }}
<link rel="stylesheet" href="/static/css/dashboard.css">
<link rel="stylesheet" href="/static/css/components/stats-card.css">
<link rel="stylesheet" href="/static/css/components/alert-card.css">
<link rel="stylesheet" href="/static/css/components/silence-card.css">
{{ end }}

{{ define "extra_js" }}
<script>
// Progressive Enhancement: Auto-refresh dashboard every 30s (idle callback)
if ('requestIdleCallback' in window) {
  setInterval(() => {
    requestIdleCallback(() => {
      console.log('[Dashboard] Auto-refresh triggered');
      location.reload();
    });
  }, 30000); // 30 seconds
}
</script>
{{ end }}
