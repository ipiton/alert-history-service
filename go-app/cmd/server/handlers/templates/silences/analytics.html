{{template "base" .}}

{{define "title"}}Silence Analytics{{end}}

{{define "content"}}
<div class="analytics-page">
    <header class="page-header">
        <div>
            <h1>Silence Analytics</h1>
            <p class="page-description">Statistics and insights about silence usage</p>
        </div>
        <div class="time-range-selector">
            <select id="time-range" aria-label="Time range selector">
                <option value="last_24h">Last 24 Hours</option>
                <option value="last_7d" {{if eq .TimeRange "last_7_days"}}selected{{end}}>Last 7 Days</option>
                <option value="last_30d">Last 30 Days</option>
                <option value="last_90d">Last 90 Days</option>
            </select>
        </div>
    </header>

    <!-- Statistics Cards -->
    <section class="stats-grid">
        <div class="stat-card stat-primary">
            <div class="stat-icon">üìä</div>
            <div class="stat-content">
                <div class="stat-value">{{.Stats.Total}}</div>
                <div class="stat-label">Total Silences</div>
            </div>
        </div>

        <div class="stat-card stat-success">
            <div class="stat-icon">‚úì</div>
            <div class="stat-content">
                <div class="stat-value">{{.Stats.Active}}</div>
                <div class="stat-label">Active Now</div>
            </div>
        </div>

        <div class="stat-card stat-info">
            <div class="stat-icon">‚è≥</div>
            <div class="stat-content">
                <div class="stat-value">{{.Stats.Pending}}</div>
                <div class="stat-label">Pending</div>
            </div>
        </div>

        <div class="stat-card stat-secondary">
            <div class="stat-icon">‚èπ</div>
            <div class="stat-content">
                <div class="stat-value">{{.Stats.Expired}}</div>
                <div class="stat-label">Expired</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">‚è∞</div>
            <div class="stat-content">
                <div class="stat-value">{{printf "%.1f" .Stats.AvgDuration}}h</div>
                <div class="stat-label">Avg Duration</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">üîç</div>
            <div class="stat-content">
                <div class="stat-value">{{.Stats.TotalMatchers}}</div>
                <div class="stat-label">Total Matchers</div>
            </div>
        </div>
    </section>

    <!-- Timeline Chart Placeholder -->
    <section class="chart-section">
        <h2>Silences Over Time</h2>
        <div class="chart-container">
            <canvas id="timeline-chart" aria-label="Silences timeline chart"></canvas>
            <div class="chart-placeholder">
                <p>üìà Timeline chart visualization</p>
                <small>Requires Chart.js integration (future enhancement)</small>
            </div>
        </div>
    </section>

    <!-- Top Creators Table -->
    <section class="table-section">
        <h2>Top Creators</h2>
        {{if gt (len .TopCreators) 0}}
        <div class="table-container">
            <table class="analytics-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Creator</th>
                        <th>Silences Created</th>
                        <th>Last Created</th>
                    </tr>
                </thead>
                <tbody>
                    {{range $index, $creator := .TopCreators}}
                    <tr>
                        <td class="rank">{{add $index 1}}</td>
                        <td>{{$creator.Creator}}</td>
                        <td><strong>{{$creator.Count}}</strong></td>
                        <td><time>{{timeAgo $creator.LastCreated}}</time></td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        {{else}}
        <div class="empty-placeholder">
            <p>No data available</p>
        </div>
        {{end}}
    </section>

    <!-- Top Silenced Alerts -->
    <section class="table-section">
        <h2>Most Silenced Alerts</h2>
        {{if gt (len .TopSilenced) 0}}
        <div class="table-container">
            <table class="analytics-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Alert Name</th>
                        <th>Times Silenced</th>
                        <th>Total Duration</th>
                    </tr>
                </thead>
                <tbody>
                    {{range $index, $alert := .TopSilenced}}
                    <tr>
                        <td class="rank">{{add $index 1}}</td>
                        <td><code>{{$alert.AlertName}}</code></td>
                        <td><strong>{{$alert.TimesSilenced}}</strong></td>
                        <td>{{humanDuration $alert.TotalDuration}}</td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        {{else}}
        <div class="empty-placeholder">
            <p>No data available</p>
            <small>Create silences to see analytics</small>
        </div>
        {{end}}
    </section>
</div>

<style>
    .analytics-page {
        max-width: 1200px;
        margin: 0 auto;
    }
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
    }
    .page-header h1 {
        font-size: 32px;
        font-weight: 600;
        margin-bottom: 8px;
    }
    .page-description {
        color: var(--color-text-secondary);
        font-size: 16px;
    }
    .time-range-selector select {
        padding: 8px 16px;
        border: 1px solid var(--color-border);
        border-radius: 4px;
        font-size: 14px;
        background-color: white;
        cursor: pointer;
    }

    /* Statistics Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 16px;
        margin-bottom: 32px;
    }
    .stat-card {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 16px;
    }
    .stat-icon {
        font-size: 36px;
    }
    .stat-content {
        display: flex;
        flex-direction: column;
    }
    .stat-value {
        font-size: 28px;
        font-weight: 600;
    }
    .stat-label {
        font-size: 12px;
        color: var(--color-text-secondary);
        text-transform: uppercase;
    }
    .stat-primary .stat-value {
        color: var(--color-primary);
    }
    .stat-success .stat-value {
        color: var(--color-success);
    }
    .stat-info .stat-value {
        color: var(--color-info);
    }
    .stat-secondary .stat-value {
        color: var(--color-text-secondary);
    }

    /* Chart Section */
    .chart-section {
        background-color: white;
        padding: 24px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 24px;
    }
    .chart-section h2 {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 16px;
    }
    .chart-container {
        position: relative;
        height: 300px;
    }
    .chart-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        background-color: var(--color-bg-secondary);
        border-radius: 4px;
        border: 2px dashed var(--color-border);
    }
    .chart-placeholder p {
        font-size: 18px;
        margin-bottom: 8px;
    }
    .chart-placeholder small {
        color: var(--color-text-secondary);
    }

    /* Table Section */
    .table-section {
        background-color: white;
        padding: 24px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 24px;
    }
    .table-section h2 {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 16px;
    }
    .table-container {
        overflow-x: auto;
    }
    .analytics-table {
        width: 100%;
        border-collapse: collapse;
    }
    .analytics-table th,
    .analytics-table td {
        padding: 12px 16px;
        text-align: left;
        border-bottom: 1px solid var(--color-border);
    }
    .analytics-table thead th {
        background-color: var(--color-bg-secondary);
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        color: var(--color-text-secondary);
    }
    .analytics-table tbody tr:hover {
        background-color: var(--color-bg-secondary);
    }
    .analytics-table .rank {
        font-weight: 600;
        color: var(--color-primary);
        width: 60px;
    }
    .analytics-table code {
        font-family: monospace;
        background-color: var(--color-bg-secondary);
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 13px;
    }
    .empty-placeholder {
        text-align: center;
        padding: 48px;
        color: var(--color-text-secondary);
    }
    .empty-placeholder p {
        font-size: 16px;
        margin-bottom: 8px;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .page-header {
            flex-direction: column;
            align-items: stretch;
        }
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>

<script>
    // Time range selector
    document.getElementById('time-range').addEventListener('change', (e) => {
        const range = e.target.value;
        // Reload page with new time range
        window.location.href = `/ui/silences/analytics?range=${range}`;
    });

    // Auto-refresh every 5 minutes
    setTimeout(() => {
        window.location.reload();
    }, {{mul .RefreshRate.Seconds 1000}});

    // TODO: Chart.js integration for timeline visualization
    // Example:
    // const ctx = document.getElementById('timeline-chart').getContext('2d');
    // new Chart(ctx, {
    //     type: 'line',
    //     data: {
    //         labels: [...],
    //         datasets: [{...}]
    //     }
    // });
</script>
{{end}}
